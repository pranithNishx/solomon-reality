(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[965],{49625:function(e,t,s){Promise.resolve().then(s.bind(s,68023))},92735:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(39763).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},27648:function(e,t,s){"use strict";s.d(t,{default:function(){return n.a}});var a=s(72972),n=s.n(a)},68023:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return y}});var a=s(57437),n=s(2265),r=s(99376),l=s(27648),i=s(29827),d=s(11713),c=s(21770),o=s(71837),x=s(1217),m=s(15863),u=s(92735),p=s(18930),h=s(69064),b=s(40521);function y(){let e=(0,r.useRouter)(),{isAuthenticated:t,user:s}=(0,x.t)(),y=(0,i.NL)(),[v,j]=(0,n.useState)(1),[f,N]=(0,n.useState)(""),[g,w]=(0,n.useState)("");(0,n.useEffect)(()=>{t&&(null==s?void 0:s.role)==="admin"||e.push("/")},[t,s,e]);let{data:C,isLoading:k}=(0,d.a)({queryKey:["admin-leads",v,f,g],queryFn:async()=>(await o.fn.getAll({page:v,limit:20,status:f||void 0,search:g||void 0})).data,enabled:t&&(null==s?void 0:s.role)==="admin"}),P=(0,c.D)({mutationFn:e=>{let{id:t,status:s}=e;return o.fn.updateStatus(t,s)},onSuccess:()=>{y.invalidateQueries({queryKey:["admin-leads"]}),h.ZP.success("Lead status updated successfully")},onError:e=>{var t,s;h.ZP.error((null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.error)||"Failed to update lead status")}}),S=(0,c.D)({mutationFn:async()=>(await o.fn.exportCSV()).data,onSuccess:e=>{let t=window.URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="leads-".concat(new Date().toISOString().split("T")[0],".csv"),document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(t),document.body.removeChild(s),h.ZP.success("Leads exported successfully")},onError:e=>{var t,s;h.ZP.error((null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.error)||"Failed to export leads")}}),L=(0,c.D)({mutationFn:e=>o.fn.delete(e),onSuccess:()=>{y.invalidateQueries({queryKey:["admin-leads"]}),h.ZP.success("Lead deleted successfully")},onError:e=>{var t,s;h.ZP.error((null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.error)||"Failed to delete lead")}});if(!t||(null==s?void 0:s.role)!=="admin"||k)return(0,a.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center",children:(0,a.jsx)(m.Z,{className:"animate-spin text-accent-primary",size:40})});let E=(null==C?void 0:C.leads)||[],Z=null==C?void 0:C.pagination,_={Pending:"bg-warning/20 text-warning border-warning/30",Contacted:"bg-accent-secondary/20 text-accent-secondary border-accent-secondary/30",Converted:"bg-success/20 text-success border-success/30",Lost:"bg-error/20 text-error border-error/30"};return(0,a.jsx)("div",{className:"min-h-screen bg-background py-12 px-4",children:(0,a.jsxs)("div",{className:"max-w-[1280px] mx-auto px-4 sm:px-6 lg:px-8",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,a.jsxs)("h1",{className:"text-4xl font-display font-bold",children:[(0,a.jsx)("span",{className:"text-gradient",children:"Manage"})," ",(0,a.jsx)("span",{className:"text-text-primary",children:"Leads"})]}),(0,a.jsxs)("button",{onClick:()=>S.mutate(),className:"btn-secondary flex items-center gap-2",disabled:S.isPending,children:[(0,a.jsx)(u.Z,{size:20}),"Export CSV"]})]}),(0,a.jsx)("div",{className:"card-luxury mb-8",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold mb-2 text-text-primary",children:"Search"}),(0,a.jsx)("input",{type:"text",value:g,onChange:e=>w(e.target.value),placeholder:"Search by name, email, phone...",className:"input-elegant w-full"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold mb-2 text-text-primary",children:"Status"}),(0,a.jsxs)("select",{value:f,onChange:e=>N(e.target.value),className:"input-elegant w-full",children:[(0,a.jsx)("option",{value:"",children:"All Statuses"}),(0,a.jsx)("option",{value:"Pending",children:"Pending"}),(0,a.jsx)("option",{value:"Contacted",children:"Contacted"}),(0,a.jsx)("option",{value:"Converted",children:"Converted"}),(0,a.jsx)("option",{value:"Lost",children:"Lost"})]})]})]})}),(0,a.jsxs)("div",{className:"card-luxury overflow-x-auto",children:[(0,a.jsx)("div",{className:"overflow-x-auto custom-scrollbar",children:(0,a.jsxs)("table",{className:"w-full min-w-[800px]",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-border",children:[(0,a.jsx)("th",{className:"text-left p-4 text-accent-primary font-semibold",children:"Name"}),(0,a.jsx)("th",{className:"text-left p-4 text-accent-primary font-semibold",children:"Email"}),(0,a.jsx)("th",{className:"text-left p-4 text-accent-primary font-semibold",children:"Phone"}),(0,a.jsx)("th",{className:"text-left p-4 text-accent-primary font-semibold",children:"Property"}),(0,a.jsx)("th",{className:"text-left p-4 text-accent-primary font-semibold",children:"Message"}),(0,a.jsx)("th",{className:"text-left p-4 text-accent-primary font-semibold",children:"Status"}),(0,a.jsx)("th",{className:"text-left p-4 text-accent-primary font-semibold",children:"Date"}),(0,a.jsx)("th",{className:"text-left p-4 text-accent-primary font-semibold",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:E.map((e,t)=>(0,a.jsxs)(b.E.tr,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.02*t},className:"border-b border-border hover:bg-surface-muted transition-colors",children:[(0,a.jsx)("td",{className:"p-4 font-medium text-text-primary",children:e.name}),(0,a.jsx)("td",{className:"p-4",children:(0,a.jsx)("a",{href:"mailto:".concat(e.email),className:"text-accent-primary hover:underline break-all",children:e.email})}),(0,a.jsx)("td",{className:"p-4",children:(0,a.jsx)("a",{href:"tel:".concat(e.phone),className:"text-accent-primary hover:underline",children:e.phone})}),(0,a.jsx)("td",{className:"p-4",children:e.property_id?(0,a.jsx)(l.default,{href:"/properties/".concat(e.property_id),className:"text-accent-primary hover:underline text-sm",target:"_blank",children:"View Property"}):(0,a.jsx)("span",{className:"text-text-secondary",children:"N/A"})}),(0,a.jsx)("td",{className:"p-4 max-w-xs",children:e.message?(0,a.jsx)("div",{className:"text-text-secondary text-sm line-clamp-2",children:e.message}):(0,a.jsx)("span",{className:"text-text-secondary",children:"No message"})}),(0,a.jsx)("td",{className:"p-4",children:(0,a.jsxs)("select",{value:e.status,onChange:t=>P.mutate({id:e.id,status:t.target.value}),disabled:P.isPending,className:"px-3 py-2 rounded-lg text-sm font-semibold border transition-all ".concat(_[e.status]||"bg-surface-muted text-text-primary border-border"),children:[(0,a.jsx)("option",{value:"Pending",children:"Pending"}),(0,a.jsx)("option",{value:"Contacted",children:"Contacted"}),(0,a.jsx)("option",{value:"Converted",children:"Converted"}),(0,a.jsx)("option",{value:"Lost",children:"Lost"})]})}),(0,a.jsx)("td",{className:"p-4 text-text-secondary text-sm whitespace-nowrap",children:new Date(e.created_at).toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"})}),(0,a.jsx)("td",{className:"p-4",children:(0,a.jsx)("div",{className:"flex items-center gap-3",children:(0,a.jsx)("button",{onClick:()=>{confirm("Are you sure you want to delete the lead from ".concat(e.name,"? This action cannot be undone."))&&L.mutate(e.id)},disabled:L.isPending,className:"text-error hover:text-error/80 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Delete lead",children:(0,a.jsx)(p.Z,{size:18})})})})]},e.id))})]})}),0===E.length&&(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("p",{className:"text-text-secondary text-lg",children:"No leads found"}),(0,a.jsx)("p",{className:"text-text-secondary text-sm mt-2",children:"Leads will appear here when users submit inquiries"})]})]}),Z&&Z.pages>1&&(0,a.jsxs)("div",{className:"flex justify-center items-center gap-4 mt-8",children:[(0,a.jsx)("button",{onClick:()=>j(e=>Math.max(1,e-1)),disabled:1===v,className:"btn-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),(0,a.jsxs)("span",{className:"text-text-secondary",children:["Page ",v," of ",Z.pages]}),(0,a.jsx)("button",{onClick:()=>j(e=>Math.min(Z.pages,e+1)),disabled:v===Z.pages,className:"btn-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})})}}},function(e){e.O(0,[655,972,230,713,883,64,823,971,117,744],function(){return e(e.s=49625)}),_N_E=e.O()}]);